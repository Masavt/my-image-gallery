<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIç”»åƒæ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ï¼†æ¼«ç”»ä½œæˆ | ã¾ã•ãã‚“ã‚®ãƒ£ãƒ©ãƒªãƒ¼</title>
    <meta name="description" content="AIç”Ÿæˆç”»åƒã‚’æ¤œç´¢ã—ã¦ã€ã‚ªãƒªã‚¸ãƒŠãƒ«æ¼«ç”»ã‚’ä½œæˆï¼ç„¡æ–™ã§ä½¿ãˆã‚‹ç”»åƒæ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ã€‚">
    <meta name="keywords" content="AI ã‚¤ãƒ©ã‚¹ãƒˆ, ç”»åƒæ¤œç´¢, æ¼«ç”»ä½œæˆ, AIã‚¢ãƒ¼ãƒˆ, ç„¡æ–™, ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰">
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f2f5;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header h1 {
            margin: 0;
            font-size: 2.5em;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        .mode-switch {
            text-align: center;
            margin: 20px 0;
        }
        .mode-btn {
            padding: 12px 30px;
            margin: 0 10px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .mode-btn.active {
            background: #667eea;
            color: white;
            transform: scale(1.05);
        }
        .mode-btn:not(.active) {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }
        
        /* æ¤œç´¢ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .search-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        .search-main {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .search-input {
            flex: 1;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
        }
        .search-btn {
            padding: 15px 30px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
        }
        .filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .filter-group label {
            font-weight: bold;
            color: #555;
        }
        .filter-group select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .tag-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        .tag-checkbox {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 5px 10px;
            background: #f5f5f5;
            border-radius: 20px;
            cursor: pointer;
        }
        
        /* ç”»åƒã‚°ãƒªãƒƒãƒ‰ */
        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .image-card {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s;
            cursor: pointer;
            position: relative;
        }
        .image-card:hover {
            transform: translateY(-5px);
        }
        .image-card.selected {
            border: 3px solid #667eea;
        }
        .image-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }
        .image-info {
            padding: 15px;
        }
        .image-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .image-stats {
            font-size: 12px;
            color: #666;
            margin: 5px 0;
        }
        .image-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }
        .tag {
            background: #e3f2fd;
            color: #1976d2;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
        }
        .select-for-manga {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #ff4081;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .image-card:hover .select-for-manga {
            opacity: 1;
        }
        
        /* æ¼«ç”»ä½œæˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .manga-section {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
        }
        .manga-section.active {
            display: block;
        }
        .layout-selector {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 30px;
        }
        .layout-option {
            padding: 20px;
            border: 2px solid #ddd;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }
        .layout-option:hover {
            border-color: #667eea;
            transform: scale(1.05);
        }
        .layout-option.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        .manga-canvas {
            border: 2px dashed #ddd;
            border-radius: 10px;
            padding: 20px;
            min-height: 500px;
            position: relative;
            background: #fafafa;
        }
        .manga-4koma {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            max-width: 400px;
            margin: 0 auto;
        }
        .manga-panel {
            background: white;
            border: 2px solid #333;
            border-radius: 5px;
            min-height: 200px;
            position: relative;
            overflow: hidden;
        }
        .panel-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #999;
            font-size: 14px;
        }
        .panel-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .dialogue-bubble {
            position: absolute;
            background: white;
            border: 2px solid #333;
            border-radius: 10px;
            padding: 10px;
            max-width: 150px;
            font-size: 14px;
            cursor: move;
        }
        .selected-images {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .selected-image {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 5px;
            cursor: grab;
        }
        .dialogue-controls {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }
        .dialogue-input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .export-section {
            margin-top: 30px;
            text-align: center;
        }
        .export-btn {
            padding: 15px 40px;
            background: #4caf50;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            cursor: pointer;
        }
        
        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
        @media (max-width: 768px) {
            .filters {
                grid-template-columns: 1fr;
            }
            .image-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ”ğŸ¨ AIç”»åƒæ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ï¼†æ¼«ç”»ä½œæˆãƒ„ãƒ¼ãƒ«</h1>
        <p>ç”»åƒã‚’æ¤œç´¢ã—ã¦ã€ã‚ªãƒªã‚¸ãƒŠãƒ«æ¼«ç”»ã‚’ä½œã‚ã†ï¼</p>
    </div>

    <div class="container">
        <!-- ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ -->
        <div class="mode-switch">
            <button class="mode-btn active" onclick="switchMode('search')">ğŸ” ç”»åƒæ¤œç´¢ãƒ¢ãƒ¼ãƒ‰</button>
            <button class="mode-btn" onclick="switchMode('manga')">ğŸ“š æ¼«ç”»ä½œæˆãƒ¢ãƒ¼ãƒ‰</button>
        </div>

        <!-- æ¤œç´¢ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="search-section" id="searchSection">
            <h2>ğŸ” ç”»åƒã‚’æ¤œç´¢</h2>
            
            <div class="search-main">
                <input type="text" class="search-input" id="searchInput" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›...ï¼ˆä¾‹ï¼šç¾å°‘å¥³ã€é¢¨æ™¯ã€ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼ï¼‰">
                <button class="search-btn" onclick="performSearch()">æ¤œç´¢</button>
            </div>

            <div class="filters">
                <div class="filter-group">
                    <label>ã‚¹ã‚¿ã‚¤ãƒ«</label>
                    <select id="styleFilter">
                        <option value="">ã™ã¹ã¦</option>
                        <option value="anime">ã‚¢ãƒ‹ãƒ¡</option>
                        <option value="realistic">ãƒªã‚¢ãƒ«</option>
                        <option value="fantasy">ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼</option>
                        <option value="cyberpunk">ã‚µã‚¤ãƒãƒ¼ãƒ‘ãƒ³ã‚¯</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>ã‚«ãƒ©ãƒ¼</label>
                    <select id="colorFilter">
                        <option value="">ã™ã¹ã¦</option>
                        <option value="colorful">ã‚«ãƒ©ãƒ•ãƒ«</option>
                        <option value="monochrome">ãƒ¢ãƒã‚¯ãƒ­</option>
                        <option value="pastel">ãƒ‘ã‚¹ãƒ†ãƒ«</option>
                        <option value="dark">ãƒ€ãƒ¼ã‚¯</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>ã‚«ãƒ†ã‚´ãƒªãƒ¼</label>
                    <select id="categoryFilter">
                        <option value="">ã™ã¹ã¦</option>
                        <option value="character">ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼</option>
                        <option value="landscape">é¢¨æ™¯</option>
                        <option value="object">ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ</option>
                        <option value="abstract">æŠ½è±¡</option>
                    </select>
                </div>
            </div>

            <div class="tag-filters">
                <label class="tag-checkbox">
                    <input type="checkbox" value="ç¾å°‘å¥³"> ç¾å°‘å¥³
                </label>
                <label class="tag-checkbox">
                    <input type="checkbox" value="ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼"> ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼
                </label>
                <label class="tag-checkbox">
                    <input type="checkbox" value="é¢¨æ™¯"> é¢¨æ™¯
                </label>
                <label class="tag-checkbox">
                    <input type="checkbox" value="å‹•ç‰©"> å‹•ç‰©
                </label>
                <label class="tag-checkbox">
                    <input type="checkbox" value="SF"> SF
                </label>
            </div>
        </div>

        <!-- ç”»åƒã‚°ãƒªãƒƒãƒ‰ -->
        <div class="image-grid" id="imageGrid"></div>

        <!-- æ¼«ç”»ä½œæˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="manga-section" id="mangaSection">
            <h2>ğŸ“š æ¼«ç”»ã‚’ä½œæˆ</h2>

            <!-- é¸æŠã—ãŸç”»åƒ -->
            <div class="selected-images" id="selectedImages">
                <p style="color: #999;">é¸æŠã—ãŸç”»åƒãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</p>
            </div>

            <!-- ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆé¸æŠ -->
            <div class="layout-selector">
                <div class="layout-option selected" onclick="selectLayout('4koma')">
                    <h3>4ã‚³ãƒæ¼«ç”»</h3>
                    <p>ç¸¦4ã‚³ãƒã®å®šç•ªã‚¹ã‚¿ã‚¤ãƒ«</p>
                </div>
                <div class="layout-option" onclick="selectLayout('2x2')">
                    <h3>2Ã—2ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ</h3>
                    <p>4ã¤ã®ãƒ‘ãƒãƒ«</p>
                </div>
                <div class="layout-option" onclick="selectLayout('free')">
                    <h3>ãƒ•ãƒªãƒ¼ã‚¹ã‚¿ã‚¤ãƒ«</h3>
                    <p>è‡ªç”±ã«ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ</p>
                </div>
            </div>

            <!-- æ¼«ç”»ã‚­ãƒ£ãƒ³ãƒã‚¹ -->
            <div class="manga-canvas" id="mangaCanvas">
                <div class="manga-4koma" id="mangaPanels">
                    <div class="manga-panel" ondrop="dropImage(event, 0)" ondragover="allowDrop(event)">
                        <div class="panel-placeholder">ç”»åƒã‚’ãƒ‰ãƒ­ãƒƒãƒ—</div>
                    </div>
                    <div class="manga-panel" ondrop="dropImage(event, 1)" ondragover="allowDrop(event)">
                        <div class="panel-placeholder">ç”»åƒã‚’ãƒ‰ãƒ­ãƒƒãƒ—</div>
                    </div>
                    <div class="manga-panel" ondrop="dropImage(event, 2)" ondragover="allowDrop(event)">
                        <div class="panel-placeholder">ç”»åƒã‚’ãƒ‰ãƒ­ãƒƒãƒ—</div>
                    </div>
                    <div class="manga-panel" ondrop="dropImage(event, 3)" ondragover="allowDrop(event)">
                        <div class="panel-placeholder">ç”»åƒã‚’ãƒ‰ãƒ­ãƒƒãƒ—</div>
                    </div>
                </div>
            </div>

            <!-- ã‚»ãƒªãƒ•è¿½åŠ  -->
            <div class="dialogue-controls">
                <input type="text" class="dialogue-input" id="dialogueInput" placeholder="ã‚»ãƒªãƒ•ã‚’å…¥åŠ›...">
                <button class="search-btn" onclick="addDialogue()">ã‚»ãƒªãƒ•ã‚’è¿½åŠ </button>
            </div>

            <!-- ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ -->
            <div class="export-section">
                <button class="export-btn" onclick="exportManga()">ğŸ’¾ æ¼«ç”»ã‚’ä¿å­˜</button>
            </div>
        </div>
    </div>

    <script>
        // ç”»åƒãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆæ‹¡å¼µç‰ˆï¼‰
        const images = [
            {
                id: 1,
                url: "https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400",
                title: "ç¾ã—ã„å±±ã®é¢¨æ™¯",
                tags: ["è‡ªç„¶", "å±±", "é¢¨æ™¯"],
                category: "landscape",
                style: "realistic",
                color: "colorful",
                views: 1250,
                downloads: 89
            },
            {
                id: 2,
                url: "https://images.unsplash.com/photo-1581833971358-2c8b550f87b3?w=400",
                title: "ã‚¢ãƒ‹ãƒ¡é¢¨ã‚¤ãƒ©ã‚¹ãƒˆ",
                tags: ["ã‚¢ãƒ‹ãƒ¡", "ã‚¤ãƒ©ã‚¹ãƒˆ", "ç¾å°‘å¥³"],
                category: "character",
                style: "anime",
                color: "colorful",
                views: 3200,
                downloads: 234
            },
            {
                id: 3,
                url: "https://images.unsplash.com/photo-1518837695005-2083093ee35b?w=400",
                title: "æµ·ã®å¤•æ—¥",
                tags: ["æµ·", "å¤•æ—¥", "é¢¨æ™¯"],
                category: "landscape",
                style: "realistic",
                color: "colorful",
                views: 2100,
                downloads: 156
            },
            {
                id: 4,
                url: "https://images.unsplash.com/photo-1493514789931-586cb221d7a7?w=400",
                title: "å®‡å®™ã®ç¥ç§˜",
                tags: ["å®‡å®™", "æ˜Ÿ", "ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼"],
                category: "abstract",
                style: "fantasy",
                color: "dark",
                views: 5000,
                downloads: 400
            },
            {
                id: 5,
                url: "https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=400",
                title: "æ£®ã®å°é“",
                tags: ["æ£®", "è‡ªç„¶", "é“"],
                category: "landscape",
                style: "realistic",
                color: "colorful",
                views: 980,
                downloads: 67
            },
            {
                id: 6,
                url: "https://images.unsplash.com/photo-1469474968028-56623f02e42e?w=400",
                title: "æ˜Ÿç©ºã®å¤œ",
                tags: ["æ˜Ÿ", "å¤œ", "è‡ªç„¶"],
                category: "landscape",
                style: "realistic",
                color: "dark",
                views: 3200,
                downloads: 234
            }
        ];

        // é¸æŠã•ã‚ŒãŸç”»åƒ
        let selectedImages = [];
        let currentMode = 'search';
        let currentLayout = '4koma';

        // åˆæœŸè¡¨ç¤º
        displayImages(images);

        // ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ
        function switchMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            if (mode === 'search') {
                document.getElementById('searchSection').style.display = 'block';
                document.getElementById('imageGrid').style.display = 'grid';
                document.getElementById('mangaSection').classList.remove('active');
            } else {
                document.getElementById('searchSection').style.display = 'none';
                document.getElementById('imageGrid').style.display = 'none';
                document.getElementById('mangaSection').classList.add('active');
                updateSelectedImagesDisplay();
            }
        }

        // ç”»åƒæ¤œç´¢
        function performSearch() {
            const keyword = document.getElementById('searchInput').value.toLowerCase();
            const style = document.getElementById('styleFilter').value;
            const color = document.getElementById('colorFilter').value;
            const category = document.getElementById('categoryFilter').value;
            const selectedTags = Array.from(document.querySelectorAll('.tag-checkbox input:checked')).map(cb => cb.value);
            
            let results = images;
            
            // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢
            if (keyword) {
                results = results.filter(img => 
                    img.title.toLowerCase().includes(keyword) ||
                    img.tags.some(tag => tag.toLowerCase().includes(keyword))
                );
            }
            
            // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨
            if (style) results = results.filter(img => img.style === style);
            if (color) results = results.filter(img => img.color === color);
            if (category) results = results.filter(img => img.category === category);
            
            // ã‚¿ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
            if (selectedTags.length > 0) {
                results = results.filter(img =>
                    selectedTags.some(tag => img.tags.includes(tag))
                );
            }
            
            displayImages(results);
        }

        // ç”»åƒè¡¨ç¤º
        function displayImages(imagesToShow) {
            const grid = document.getElementById('imageGrid');
            grid.innerHTML = '';
            
            imagesToShow.forEach(image => {
                const card = document.createElement('div');
                card.className = 'image-card';
                if (selectedImages.find(img => img.id === image.id)) {
                    card.classList.add('selected');
                }
                
                card.innerHTML = `
                    <img src="${image.url}" alt="${image.title}" draggable="true" ondragstart="dragStart(event, ${image.id})">
                    <button class="select-for-manga" onclick="toggleImageSelection(${image.id})">
                        ${selectedImages.find(img => img.id === image.id) ? 'âœ“ é¸æŠä¸­' : '+ é¸æŠ'}
                    </button>
                    <div class="image-info">
                        <div class="image-title">${image.title}</div>
                        <div class="image-stats">
                            ğŸ‘ ${image.views} views | ğŸ’¾ ${image.downloads} downloads
                        </div>
                        <div class="image-tags">
                            ${image.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                        </div>
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }

        // ç”»åƒé¸æŠ
        function toggleImageSelection(imageId) {
            const image = images.find(img => img.id === imageId);
            const index = selectedImages.findIndex(img => img.id === imageId);
            
            if (index > -1) {
                selectedImages.splice(index, 1);
            } else {
                selectedImages.push(image);
            }
            
            displayImages(images);
            updateSelectedImagesDisplay();
        }

        // é¸æŠç”»åƒè¡¨ç¤ºæ›´æ–°
        function updateSelectedImagesDisplay() {
            const container = document.getElementById('selectedImages');
            if (selectedImages.length === 0) {
                container.innerHTML = '<p style="color: #999;">é¸æŠã—ãŸç”»åƒãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</p>';
                return;
            }
            
            container.innerHTML = selectedImages.map(img => `
                <img src="${img.url}" alt="${img.title}" class="selected-image" 
                     draggable="true" ondragstart="dragStart(event, ${img.id})">
            `).join('');
        }

        // ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆé¸æŠ
        function selectLayout(layout) {
            currentLayout = layout;
            document.querySelectorAll('.layout-option').forEach(opt => opt.classList.remove('selected'));
            event.target.closest('.layout-option').classList.add('selected');
            
            const canvas = document.getElementById('mangaPanels');
            
            if (layout === '4koma') {
                canvas.className = 'manga-4koma';
                canvas.innerHTML = `
                    <div class="manga-panel" ondrop="dropImage(event, 0)" ondragover="allowDrop(event)">
                        <div class="panel-placeholder">ç”»åƒã‚’ãƒ‰ãƒ­ãƒƒãƒ—</div>
                    </div>
                    <div class="manga-panel" ondrop="dropImage(event, 1)" ondragover="allowDrop(event)">
                        <div class="panel-placeholder">ç”»åƒã‚’ãƒ‰ãƒ­ãƒƒãƒ—</div>
                    </div>
                    <div class="manga-panel" ondrop="dropImage(event, 2)" ondragover="allowDrop(event)">
                        <div class="panel-placeholder">ç”»åƒã‚’ãƒ‰ãƒ­ãƒƒãƒ—</div>
                    </div>
                    <div class="manga-panel" ondrop="dropImage(event, 3)" ondragover="allowDrop(event)">
                        <div class="panel-placeholder">ç”»åƒã‚’ãƒ‰ãƒ­ãƒƒãƒ—</div>
                    </div>
                `;
            } else if (layout === '2x2') {
                canvas.style.display = 'grid';
                canvas.style.gridTemplateColumns = '1fr 1fr';
                canvas.style.maxWidth = '600px';
                canvas.innerHTML = `
                    <div class="manga-panel" ondrop="dropImage(event, 0)" ondragover="allowDrop(event)">
                        <div class="panel-placeholder">ç”»åƒã‚’ãƒ‰ãƒ­ãƒƒãƒ—</div>
                    </div>
                    <div class="manga-panel" ondrop="dropImage(event, 1)" ondragover="allowDrop(event)">
                        <div class="panel-placeholder">ç”»åƒã‚’ãƒ‰ãƒ­ãƒƒãƒ—</div>
                    </div>
                    <div class="manga-panel" ondrop="dropImage(event, 2)" ondragover="allowDrop(event)">
                        <div class="panel-placeholder">ç”»åƒã‚’ãƒ‰ãƒ­ãƒƒãƒ—</div>
                    </div>
                    <div class="manga-panel" ondrop="dropImage(event, 3)" ondragover="allowDrop(event)">
                        <div class="panel-placeholder">ç”»åƒã‚’ãƒ‰ãƒ­ãƒƒãƒ—</div>
                    </div>
                `;
            }
        }

        // ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—
        let draggedImageId = null;

        function dragStart(event, imageId) {
            draggedImageId = imageId;
        }

        function allowDrop(event) {
            event.preventDefault();
        }

        function dropImage(event, panelIndex) {
            event.preventDefault();
            const panel = event.target.closest('.manga-panel');
            const image = images.find(img => img.id === draggedImageId);
            
            if (image && panel) {
                panel.innerHTML = `<img src="${image.url}" alt="${image.title}" class="panel-image">`;
            }
        }

        // ã‚»ãƒªãƒ•è¿½åŠ 
        function addDialogue() {
            const text = document.getElementById('dialogueInput').value;
            if (!text) return;
            
            const bubble = document.createElement('div');
            bubble.className = 'dialogue-bubble';
            bubble.textContent = text;
            bubble.style.top = '20px';
            bubble.style.left = '20px';
            
            // ãƒ‰ãƒ©ãƒƒã‚°å¯èƒ½ã«ã™ã‚‹
            makeDraggable(bubble);
            
            document.getElementById('mangaCanvas').appendChild(bubble);
            document.getElementById('dialogueInput').value = '';
        }

        // è¦ç´ ã‚’ãƒ‰ãƒ©ãƒƒã‚°å¯èƒ½ã«ã™ã‚‹
        function makeDraggable(element) {
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
            element.onmousedown = dragMouseDown;

            function dragMouseDown(e) {
                e = e || window.event;
                e.preventDefault();
                pos3 = e.clientX;
                pos4 = e.clientY;
                document.onmouseup = closeDragElement;
                document.onmousemove = elementDrag;
            }

            function elementDrag(e) {
                e = e || window.event;
                e.preventDefault();
                pos1 = pos3 - e.clientX;
                pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;
                element.style.top = (element.offsetTop - pos2) + "px";
                element.style.left = (element.offsetLeft - pos1) + "px";
            }

            function closeDragElement() {
                document.onmouseup = null;
                document.onmousemove = null;
            }
        }

        // æ¼«ç”»ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        function exportManga() {
            alert('æ¼«ç”»ã®ä¿å­˜æ©Ÿèƒ½ã¯æº–å‚™ä¸­ã§ã™ï¼\n\nç¾åœ¨ã¯ç”»é¢ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’æ’®ã£ã¦ä¿å­˜ã—ã¦ãã ã•ã„ã€‚');
            // å°†æ¥çš„ã«ã¯html2canvasãªã©ã‚’ä½¿ã£ã¦ç”»åƒã¨ã—ã¦ä¿å­˜
        }

        // Enterã‚­ãƒ¼ã§æ¤œç´¢
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') performSearch();
        });
    </script>
</body>
</html>
